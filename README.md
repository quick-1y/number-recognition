# Number Recognition Platform

Проект реализует скелет системы автоматического распознавания автомобильных номеров, включающий REST API, базу данных, заготовку пайплайна детекции/OCR и инфраструктуру развёртывания. Архитектура покрывает ключевые пункты ТЗ: каналы RTSP/видео, списки (белый/чёрный/инфо), события распознавания, вебхуки, health-check и метрики Prometheus.

## Возможности
- FastAPI приложение с префиксом `/api/v1`.
- CRUD для каналов наблюдения и списков номеров.
- Регистрация событий распознавания, хранение трека, confidence, bbox и метаданных.
- Простая регистрация пользователей, выдача JWT токенов и проверка ролей через bearer-токен.
- Управление подписками на вебхуки и журнал доставок.
- Метрики Prometheus `/metrics` и health-check маршруты `/health/live`, `/health/ready`.
- Минимальный Rules Engine для демонстрации сценариев обработки событий.
- Черновой модуль пайплайна, разделяющий этапы детекции, OCR и постобработки.

## Запуск локально
1. Установите зависимости: `pip install -e .`
2. Запустите сервер: `uvicorn app.main:app --reload`.
3. Откройте OpenAPI: http://localhost:8000/docs.

По умолчанию используется SQLite (`data/dev.db`). Замените `DATABASE_URL` в переменных окружения для подключения к PostgreSQL.

## Docker Compose
```
docker-compose up --build
```
Запускается FastAPI, PostgreSQL и MinIO (S3). Параметры можно менять в `docker-compose.yml`.

## Ключевые точки API
- `/api/v1/auth/register` — регистрация пользователя.
- `/api/v1/auth/token` — получение JWT (OAuth2 Password Flow).
- `/api/v1/channels` — управление каналами и ROI.
- `/api/v1/plate-lists` — списки номеров и элементы.
- `/api/v1/recognitions` — последние события распознавания.
- `/api/v1/webhooks` — подписки и история доставок.

## Пайплайн
`app/worker/pipeline.py` содержит заглушку пайплайна: на вход подаются кадры, выполняются детекция → OCR → постобработка → правила. Модуль расширяется конкретными реализациями (YOLO, ByteTrack, PaddleOCR), поддерживает GPU/CPU, антидубликаты и постобработку, описанные в ТЗ.

## Расширение
- Добавьте реальные детекторы и OCR-движки в `app/worker` и `app/services`.
- Реализуйте запись клипов и взаимодействие с тревожными выходами камер в отдельных сервисах.
- Подключите Alembic миграции для схемы БД и полноценный RBAC.

